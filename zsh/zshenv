#!/usr/bin/env zsh
# definitions for all sessions and scripts

export DOTFILES=$HOME/.dotfiles
export OSTYPE=$(uname -s)
export ARCHITECTURE=$(uname -m)

if [[ "$TERM_PROGRAM" == "ghostty" ]]; then
    export TERM=xterm-256color
fi

path=(
  # path to linux and homebrew intel-based binaries
  /usr/local/{bin,sbin}
  # os-specific dotfile binaries
  $DOTFILES/bin/$OSTYPE
  # user-specific binaries for linux
  $HOME/bin
  $HOME/.local/bin
  $path
)

[[ $ARCHITECTURE == 'arm64' ]] && {
  path=(
    # homebrew arm-based binaries
    /opt/homebrew/{bin,sbin}
    $path
  )
}

# Zsh-specific environment variables (common ones are in shared/00-env.sh)
# Note: EDITOR, VISUAL, LESS, PAGER, MANPAGER, LANG, LC_ALL are set in shared/00-env.sh

if [[ "$OSTYPE" == "Darwin" ]]; then
  export BROWSER="open"
elif [[ "$OSTYPE" == "Linux" ]]; then
  [ $commands[firefox] ] && export BROWSER="firefox"
fi

# name of the browser application for various scripts
if [[ -z "$BROWSER_NAME" ]] && [[ "$OSTYPE" == "Darwin" ]]; then
  export BROWSER_NAME=$(osascript -e 'use framework "Cocoa"' -e 'name of application (((current application'\''s NSWorkspace'\''s sharedWorkspace()'\''s URLForApplicationToOpenURL:(current application'\''s NSURL'\''s URLWithString:"http://"))'\''s |path|()) as text)')
fi

export GPG_TTY=$(tty)

if [ -d "$HOME/.cargo" ]; then
  source "$HOME/.cargo/env";
fi
